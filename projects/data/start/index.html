
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>The fastest and smoothest way to good architecture</title>
  <meta name="author" content="Tim Rayburn & Devlin Liles">

   
  <meta name="description" content="">
  
  <meta name="keywords" content="">

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://hwyfwk.com/projects/data/start/">
  <link href="//favicon.png" rel="icon">
  <link href='http://fonts.googleapis.com/css?family=Quicksand:300,400' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,300' rel='stylesheet' type='text/css'>
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="The fastest and smoothest way to good architecture" type="application/atom+xml">
  <script src="/js/jquery.js"></script>
  <script src="/js/bootstrap-collapse.js"></script>
  <script src="/js/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/js/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <div class="navbar navbar-inverse navbar-static-top">
  	<div class="navbar-inner">
  	  <div class="container">
        <a class="btn btn-navbar" data-toggle="collapse" data-target=".navbar-responsive-collapse">
          <span class="fui-menu-24"></span>
        </a>
  	  	<div class="nav-collapse collapse navbar-responsive-collapse" style="height:0;">
  	      <ul class="nav">
    
        <li ><a href="/index.html">Home</a></li>
    
        <li ><a href="/team/index.html">Team</a></li>
    
        <li ><a href="/projects/index.html">Projects</a></li>
    
        <li ><a href="/license.html">License</a></li>
    
        <li ><a href="/releases.html">Releases</a></li>
    
        <li ><a href="/contribute.html">Contribute</a></li>
    
        <li ><a href="/support.html">Support</a></li>
    
        <li ><a href="/faq.html">FAQs</a></li>
    
</ul>

<ul class="nav pull-right">
    
    <li><a href="http://github.com/HighwayFramework" title="Github Profile"><i class="icon-github-sign social-navbar"></i></a></li>
    
    
    
    <li><a href="http://twitter.com/HwyFwk" title="Twitter Profile"><i class="icon-twitter-sign social-navbar"></i></a></li>
    
    
    
    
    <li><a href="mailto:Team@HwyFwk.com" title="Email"><i class="icon-envelope-alt social-navbar"></i></a></li>
    
</ul>

  	    </div>
  	  </div>
  	</div>
  </div>
  <div class="container" id="main">
    <div class="span12">
      <div class="row-fluid">
        <div id="content">
          <article role="article">
  
  





<div class="section-nav">
	<h3>
		<a href="/projects/data/start/index.html" >Project Home</a>
		 |
			<a href="/projects/data/start/start" >Getting Started</a>
		
		 |
			<a href="/projects/data/start/features" >Features</a>
		
		 |
			<a href="/projects/data/start/releases" >Release Notes</a>
		
		 |
			<a href="/projects/data/start/api" >API Documentation</a>
		
		 |
			<a href="/projects/data/start/faq" >FAQs</a>
		
	</h3>
</div>
<p>#Getting Started#
So you want to get started with Highway.Data, but don’t know where to start? Lets start the same place we always start with something new. “Tests!!!”</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="n">TestClass</span><span class="p">]</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">DriversEducationServiceTests</span>
<span class="p">{</span>
   <span class="p">[</span><span class="n">TestMethod</span><span class="p">]</span>
   <span class="k">public</span> <span class="k">void</span> <span class="nf">ShouldAddDriverByName</span><span class="p">()</span>
   <span class="p">{</span>
		<span class="c1">//arrange</span>
		<span class="kt">var</span> <span class="n">context</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">InMemoryDataContext</span><span class="p">();</span>
		<span class="kt">var</span> <span class="n">service</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">DriversEducationService</span><span class="p">(</span><span class="k">new</span> <span class="nf">Repository</span><span class="p">(</span><span class="n">context</span><span class="p">));</span>

	   <span class="c1">//act</span>
		<span class="n">service</span><span class="p">.</span><span class="nf">AddDriver</span><span class="p">(</span><span class="s">"Devlin"</span><span class="p">);</span>

		<span class="c1">//assert</span>
		<span class="n">context</span><span class="p">.</span><span class="n">AsQueryable</span><span class="p">&lt;</span><span class="n">Driver</span><span class="p">&gt;().</span><span class="nf">Count</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">Name</span> <span class="p">==</span> <span class="s">"Devlin"</span><span class="p">).</span><span class="nf">Should</span><span class="p">().</span><span class="nf">Be</span><span class="p">(</span><span class="m">1</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Now that we have a test, lets work on an implementation. In this implementation we are going to focus on the patterns in Highway.Data. We will dive into Entity Framework, nHibernate, and RavenDb later. In order to facilitate this, we are going to use the InMemoryDataContext that ships with Highway.Data as our test stub.</p>

<p>We just need to add a driver to the database.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    public class DriversEducationService
    {
        private readonly IRepository _repository;

        public DriversEducationService(IRepository repository)
        {
            _repository = repository;
        }

        public void AddDriver(string name)
        {
            _repository.Context.Add(new Driver(name));
        }
    }

    public class Driver
    {
        public string Name { get; set; }

        public Driver(string name)
        {
            Name = name;
        }
    }
</code></pre></div></div>

<p>Once we have the repository, we can use the Context on Repository as a unit of work. Check <a href="http://www.martinfowler.com/eaaCatalog/repository.html" title="Repository Pattern">here</a> and <a href="http://www.martinfowler.com/eaaCatalog/unitOfWork.html" title="Unit of Work Pattern">here</a> read up on Repository or Unit of Work.</p>

<p>This gives us the ability to separate the persistence from the business logic of our services.</p>

<p>Once we have added an object we will obviously need to query the object back out. For this we will need to use a mixture of <a href="http://en.wikipedia.org/wiki/Specification_pattern" title="Specification Pattern">Specification Pattern</a> and <a href="http://martinfowler.com/eaaCatalog/queryObject.html" title="Query Object Pattern">Query Object Pattern</a>. Below is the test for querying back an object.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    [TestMethod]
    public void ShouldQueryDriversByName()
    {
        //arrange
        var context = new InMemoryDataContext();
        context.Add(new Driver("Devlin"));
        context.Add(new Driver("Tim"));

        var service = new DriversEducationService(new Repository(context));

        //act
        Driver driver = service.GetDriver("Devlin");

        //assert
        driver.Should().NotBeNull();
    }
</code></pre></div></div>

<p>And our service code that passes the test.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    public Driver GetDriver(string name)
    {
        return _repository.Find(new DriverByName(name));
    }
</code></pre></div></div>

<p>With the following query.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    public class DriverByName : Scalar&lt;Driver&gt;
    {
        public DriverByName(string name)
        {
            ContextQuery = c =&gt; c.AsQueryable&lt;Driver&gt;().Single(x =&gt; x.Name == name);
        }
    }
</code></pre></div></div>

<p>If we want to query a collection of entities, that is as simple as changing the base class our query object inherits from.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    public class DriversByName : Query&lt;Driver&gt;
    {
        public DriversByName(string name)
        {
            ContextQuery = c =&gt; c.AsQueryable&lt;Driver&gt;().Where(x =&gt; x.Name == name);
        }
    }
</code></pre></div></div>

<p>Built into the framework is the ability to fire off commands that affect the database but don’t return a value. The syntax is very similar.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    public void RemoveDriversByName(string name)
    {
        _repository.Execute(new RemoveDrivers(name));
    }

    public class RemoveDrivers : Command
    {
        public RemoveDrivers(string name)
        {
            ContextQuery = c =&gt;
            {
                foreach (var driver in c.AsQueryable&lt;Driver&gt;().Where(x=&gt;x.Name == name))
                {
                    c.Remove(driver);
                }
                c.Commit();
            };
        }
    }
</code></pre></div></div>



</article>




        </div>
      </div>
      <div class="row-fluid">
        <footer class="footer-page" role="contentinfo">
          <p>
  Copyright &copy; 2019 - Tim Rayburn & Devlin Liles -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span> - Theme by <a href="http://alexgaribay.com">Alex Garibay</a>
</p>


        </footer>
      </div>
    </div>
  </div>
  

<script type="text/javascript">
      var disqus_shortname = 'highwayframework';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
