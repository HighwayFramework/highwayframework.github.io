
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>The fastest and smoothest way to good architecture</title>
  <meta name="author" content="Tim Rayburn & Devlin Liles">

   
  <meta name="description" content="">
  
  <meta name="keywords" content="">

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://hwyfwk.com/projects/data/start.html">
  <link href="/favicon.png" rel="icon">
  <link href='http://fonts.googleapis.com/css?family=Quicksand:300,400' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,300' rel='stylesheet' type='text/css'>
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="The fastest and smoothest way to good architecture" type="application/atom+xml">
  <script src="/js/jquery.js"></script>
  <script src="/js/bootstrap-collapse.js"></script>
  <script src="/js/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/js/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <div class="navbar navbar-inverse navbar-static-top">
  	<div class="navbar-inner">
  	  <div class="container">
        <a class="btn btn-navbar" data-toggle="collapse" data-target=".navbar-responsive-collapse">
          <span class="fui-menu-24"></span>
        </a>
  	  	<div class="nav-collapse collapse navbar-responsive-collapse" style="height:0;">
  	      <ul class="nav">
    
        <li ><a href="/index.html">Home</a></li>
    
        <li ><a href="/team/index.html">Team</a></li>
    
        <li ><a href="/projects/index.html">Projects</a></li>
    
        <li ><a href="/license.html">License</a></li>
    
        <li ><a href="/contribute.html">Contribute</a></li>
    
        <li ><a href="/support.html">Support</a></li>
    
</ul>

<ul class="nav pull-right">
    
    <li><a href="http://github.com/HighwayFramework" title="Github Profile"><i class="icon-github-sign social-navbar"></i></a></li>
    
    
    
    <li><a href="http://twitter.com/HwyFwk" title="Twitter Profile"><i class="icon-twitter-sign social-navbar"></i></a></li>
    
    
    
    
</ul>

  	    </div>
  	  </div>
  	</div>
  </div>
  <div class="container" id="main">
    <div class="span12">
      <div class="row-fluid">
        <div id="content">
          <h1>Getting Started</h1>

<p>So you want to get started with Highway.Data, but donâ€™t know where to start? Lets start the same place we always start with something new. &ldquo;Tests!!!&rdquo;</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[TestClass]
</span><span class='line'>public class DriversEducationServiceTests
</span><span class='line'>{
</span><span class='line'>   [TestMethod]
</span><span class='line'>   public void ShouldAddDriverByName()
</span><span class='line'>   {
</span><span class='line'>      //arrange
</span><span class='line'>      var context = new InMemoryDataContext();
</span><span class='line'>      var service = new DriversEducationService(new Repository(context));
</span><span class='line'>       
</span><span class='line'>     //act
</span><span class='line'>      service.AddDriver("Devlin");
</span><span class='line'>    
</span><span class='line'>      //assert
</span><span class='line'>      context.AsQueryable&lt;Driver&gt;().Count(x =&gt; x.Name == "Devlin").Should().Be(1);
</span><span class='line'>  }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>Now that we have a test, lets work on an implementation. In this implementation we are going to focus on the patterns in Highway.Data. We will dive into Entity Framework, nHibernate, and RavenDb later. In order to facilitate this, we are going to use the InMemoryDataContext that ships with Highway.Data as our test stub.</p>

<p>We just need to add a driver to the database.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>public class DriversEducationService
</span><span class='line'>{
</span><span class='line'>    private readonly IRepository _repository;
</span><span class='line'>
</span><span class='line'>    public DriversEducationService(IRepository repository)
</span><span class='line'>    {
</span><span class='line'>        _repository = repository;
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    public void AddDriver(string name)
</span><span class='line'>    {
</span><span class='line'>        _repository.Context.Add(new Driver(name));
</span><span class='line'>    }
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>public class Driver
</span><span class='line'>{
</span><span class='line'>    public string Name { get; set; }
</span><span class='line'>
</span><span class='line'>    public Driver(string name)
</span><span class='line'>    {
</span><span class='line'>        Name = name;
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>Once we have the repository, we can use the Context on Repository as a unit of work. Check <a href="http://www.martinfowler.com/eaaCatalog/repository.html" title="Repository Pattern">here</a> and <a href="http://www.martinfowler.com/eaaCatalog/unitOfWork.html" title="Unit of Work Pattern">here</a> read up on Repository or Unit of Work.</p>

<p>This gives us the ability to separate the persistence from the business logic of our services.</p>

<p>Once we have added an object we will obviously need to query the object back out. For this we will need to use a mixture of <a href="http://en.wikipedia.org/wiki/Specification_pattern" title="Specification Pattern">Specification Pattern</a> and <a href="http://martinfowler.com/eaaCatalog/queryObject.html" title="Query Object Pattern">Query Object Pattern</a>. Below is the test for querying back an object.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[TestMethod]
</span><span class='line'>public void ShouldQueryDriversByName()
</span><span class='line'>{
</span><span class='line'>    //arrange 
</span><span class='line'>    var context = new InMemoryDataContext();
</span><span class='line'>    context.Add(new Driver("Devlin"));
</span><span class='line'>    context.Add(new Driver("Tim"));
</span><span class='line'>
</span><span class='line'>    var service = new DriversEducationService(new Repository(context));
</span><span class='line'>
</span><span class='line'>    //act
</span><span class='line'>    Driver driver = service.GetDriver("Devlin");
</span><span class='line'>
</span><span class='line'>    //assert
</span><span class='line'>    driver.Should().NotBeNull();
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>And our service code that passes the test.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>public Driver GetDriver(string name)
</span><span class='line'>{
</span><span class='line'>    return _repository.Find(new DriverByName(name));
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>With the following query.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>public class DriverByName : Scalar&lt;Driver&gt;
</span><span class='line'>{
</span><span class='line'>    public DriverByName(string name)
</span><span class='line'>    {
</span><span class='line'>        ContextQuery = c =&gt; c.AsQueryable&lt;Driver&gt;().Single(x =&gt; x.Name == name);
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>If we want to query a collection of entities, that is as simple as changing the base class our query object inherits from.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>public class DriversByName : Query&lt;Driver&gt;
</span><span class='line'>{
</span><span class='line'>    public DriversByName(string name)
</span><span class='line'>    {
</span><span class='line'>        ContextQuery = c =&gt; c.AsQueryable&lt;Driver&gt;().Where(x =&gt; x.Name == name);
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>Built into the framework is the ability to fire off commands that affect the database but don&rsquo;t return a value. The syntax is very similar.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>public void RemoveDriversByName(string name)
</span><span class='line'>{
</span><span class='line'>    _repository.Execute(new RemoveDrivers(name));
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>public class RemoveDrivers : Command
</span><span class='line'>{
</span><span class='line'>    public RemoveDrivers(string name)
</span><span class='line'>    {
</span><span class='line'>        ContextQuery = c =&gt;
</span><span class='line'>        {
</span><span class='line'>            foreach (var driver in c.AsQueryable&lt;Driver&gt;().Where(x=&gt;x.Name == name))
</span><span class='line'>            {
</span><span class='line'>                c.Remove(driver);
</span><span class='line'>            }
</span><span class='line'>            c.Commit();
</span><span class='line'>        };
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>




        </div>
      </div>
      <div class="row-fluid">
        <footer class="footer-page" role="contentinfo">
          <p>
  Copyright &copy; 2013 - Tim Rayburn & Devlin Liles -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span> - Theme by <a href="http://alexgaribay.com">Alex Garibay</a>
</p>


        </footer>
      </div>
    </div>
  </div>
  

<script type="text/javascript">
      var disqus_shortname = 'highwayframework';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
