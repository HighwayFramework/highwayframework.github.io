
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Castle Windsor with Auto Discovered Installers - The fastest and smoothest way to good architecture</title>
  <meta name="author" content="Tim Rayburn & Devlin Liles">

  
  <meta name="description" content="Configuring Castle Windsor Dependency injection is a key part of good software development, it is the D or SOLID, and yet is not something Microsoft &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://hwyfwk.com/blog/2013/10/05/castle-windsor-with-auto-discovered-installers">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="The fastest and smoothest way to good architecture" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">The fastest and smoothest way to good architecture</a></h1>
  
    <h2>A blogging framework for hackers.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:hwyfwk.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Castle Windsor With Auto Discovered Installers</h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-10-05T15:07:00-05:00" pubdate data-updated="true">Oct 5<span>th</span>, 2013</time>
        
           | <a href="#disqus_thread"
             data-disqus-identifier="http://hwyfwk.com">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><h1>Configuring Castle Windsor</h1>

<p>Dependency injection is a key part of good software development, it is the D or <a href="http://en.wikipedia.org/wiki/SOLID_(object-oriented_design)">SOLID</a>, and yet is not something <a href="http://microsoft.com">Microsoft</a> ships a solution for.  As such, we have turned to the community and the long standing, well supported, king of IoC : <a href="http://docs.castleproject.org/Default.aspx?Page=MainPage&amp;NS=Windsor&amp;AspxAutoDetectCookieSupport=1">Castle.Windsor</a></p>

<p>We configure Windsor with a set of reasonable defaults, and enable a few features which some people may not be aware of, to make it is painless as possible.  In our <code>IoC.Startup()</code> method, we do the following:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="na">    [Obsolete(&quot;Container should never be accessed directly outside of App_Start&quot;)]</span>
</span><span class='line'>    <span class="k">public</span> <span class="k">static</span> <span class="n">IWindsorContainer</span> <span class="n">Container</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Startup</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'><span class="cp">#pragma warning disable 618</span>
</span><span class='line'>        <span class="c1">// Create the container</span>
</span><span class='line'>        <span class="n">Container</span> <span class="p">=</span> <span class="k">new</span> <span class="n">WindsorContainer</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// Add the Array Resolver, so we can take dependencies on T[]</span>
</span><span class='line'>        <span class="c1">// while only registering T.</span>
</span><span class='line'>        <span class="n">Container</span><span class="p">.</span><span class="n">Kernel</span><span class="p">.</span><span class="n">Resolver</span><span class="p">.</span><span class="n">AddSubResolver</span><span class="p">(</span><span class="k">new</span> <span class="n">ArrayResolver</span><span class="p">(</span><span class="n">Container</span><span class="p">.</span><span class="n">Kernel</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// Register the kernel and container, in case an installer needs it.</span>
</span><span class='line'>        <span class="n">Container</span><span class="p">.</span><span class="n">Register</span><span class="p">(</span>
</span><span class='line'>            <span class="n">Component</span><span class="p">.</span><span class="n">For</span><span class="p">&lt;</span><span class="n">IKernel</span><span class="p">&gt;().</span><span class="n">Instance</span><span class="p">(</span><span class="n">Container</span><span class="p">.</span><span class="n">Kernel</span><span class="p">),</span>
</span><span class='line'>            <span class="n">Component</span><span class="p">.</span><span class="n">For</span><span class="p">&lt;</span><span class="n">IWindsorContainer</span><span class="p">&gt;().</span><span class="n">Instance</span><span class="p">(</span><span class="n">Container</span><span class="p">)</span>
</span><span class='line'>            <span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// Search for an use all installers in this application.</span>
</span><span class='line'>        <span class="n">Container</span><span class="p">.</span><span class="n">Install</span><span class="p">(</span><span class="n">FromAssembly</span><span class="p">.</span><span class="n">This</span><span class="p">());</span>
</span><span class='line'><span class="cp">#pragma warning restore 618</span>
</span><span class='line'>    <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>We make your instance of <a href="http://docs.castleproject.org/Default.aspx?Page=MainPage&amp;NS=Windsor&amp;AspxAutoDetectCookieSupport=1">Castle.Windsor</a> available via <code>IoC.Container</code> but we have specifically marked that as <code>[Obsolete]</code> because you should not be accessing the container directly.  Instead, we want to encourage you to rely on our injection of dependencies into your Controllers, and never directly access the container outside of App_Start.</p>

<h2>Accessing the Container without an Obsolete Warning</h2>

<p>Now, on rare occasions there will be perfectly reasonable pragmatic reasons to need to access the container.  This is the reason why we have marked the <code>[Obsolete]</code> merely as a warning, and then included the <code>#pragma</code> statements to disable those warnings in places you are accepting the need to directly access the container.  When those occur, simply surround your code with :</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="cp">#pragma warning disable 618</span>
</span><span class='line'><span class="cp">#pragma warning restore 618</span>
</span></code></pre></td></tr></table></div></figure>


<p>You should keep such sections small, and should be aware that the <code>#pragma</code> statements will also disable any other <code>[Obsolete]</code> warnings that occur between them, not just those for the <code>IoC.Container</code>.</p>

<h1>Discovering Installers</h1>

<p>Our code above includes one very small, but very powerful line that is worth highlighting:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="n">Container</span><span class="p">.</span><span class="n">Install</span><span class="p">(</span><span class="n">FromAssembly</span><span class="p">.</span><span class="n">This</span><span class="p">());</span>
</span></code></pre></td></tr></table></div></figure>


<p>This statement tells <a href="http://docs.castleproject.org/Default.aspx?Page=MainPage&amp;NS=Windsor&amp;AspxAutoDetectCookieSupport=1">Castle.Windsor</a> to scan the <strong>current assembly</strong>, looking for classes which implement the <code>IWindsorInstaller</code> interface, and to execute those components, allowing them to register components with the container.  This auto discovery is one of the best features of our IoC implementation, allowing you to segregate your registrations into small, related pieces, as you will see.</p>

<h1>Included Installers</h1>

<p>We have included several installers for you, in the various packages of Highway.OnRamp.MVC.   They are all located in the <code>Installers</code> folder of your MVC solution.  Here are their names and purposes:</p>

<ul>
<li>ControllerInstaller &ndash; Scans the current assembly for all types that implement <code>IController</code> from System.Web.Mvc and registers them with <a href="http://docs.castleproject.org/Default.aspx?Page=MainPage&amp;NS=Windsor&amp;AspxAutoDetectCookieSupport=1">Castle.Windsor</a>.  This means you never have to register your controllers manually.</li>
<li>LoggingInstaller &ndash; Configures the Castle Logging Facility, and wires it to NLog.  We will cover this is more detail when we discuss the Logging feature.</li>
<li>FilterInstaller &ndash; Is where you register all MVC filters.  We will cover this in more detail when we discuss Filter Injection.</li>
<li>HighwayDataInstaller &ndash; Is the configuration and registrations for using Highway.Data.EntityFramework for your database.  It will be covered in more detail when we discuss Data Access.</li>
</ul>

</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Tim Rayburn & Devlin Liles</span></span>

      








  


<time datetime="2013-10-05T15:07:00-05:00" pubdate data-updated="true">Oct 5<span>th</span>, 2013</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/feature/'>feature</a>, <a class='category' href='/blog/categories/onramp-mvc/'>onramp-mvc</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://hwyfwk.com/blog/2013/10/05/castle-windsor-with-auto-discovered-installers/" data-via="HwyFwk" data-counturl="http://hwyfwk.com/blog/2013/10/05/castle-windsor-with-auto-discovered-installers/" >Tweet</a>
  
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2013/10/05/highway-dot-pavement-v0-dot-3/" title="Previous Post: Highway.Pavement v0.3">&laquo; Highway.Pavement v0.3</a>
      
      
        <a class="basic-alignment right" href="/blog/2013/10/05/webactivator-for-composable-startup/" title="Next Post: WebActivator for Composable Startup">WebActivator for Composable Startup &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/10/25/advanced-queries-slash-commands-slash-scalars/">Advanced Queries / Commands /Scalars</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/10/25/pagination-of-queries/">Pagination of Queries</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/10/22/highway-dot-data-v4-dot-1-0-dot-2/">Highway.Data v4.1.0.2</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/10/19/understanding-the-patterns/">Understanding the Patterns</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/10/19/queries-slash-commands-slash-scalars/">Queries / Commands / Scalars</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/HighwayFramework">@HighwayFramework</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'HighwayFramework',
            count: 999,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Tim Rayburn & Devlin Liles -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'highwayframework';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://hwyfwk.com/blog/2013/10/05/castle-windsor-with-auto-discovered-installers/';
        var disqus_url = 'http://hwyfwk.com/blog/2013/10/05/castle-windsor-with-auto-discovered-installers/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
